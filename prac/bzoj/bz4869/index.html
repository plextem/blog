



<!DOCTYPE html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="随便搭建的博客，写一些平时的做题总结等">
      
      
      
        <meta name="author" content="本地博客">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="zh">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.3, mkdocs-material-3.0.3">
    
    
      
        <title>4869 相逢是问候 - blog</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../../_static/css/extra.css?v=2">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../../#bzoj4869" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="blog" class="md-header-nav__button md-logo">
          
            <i class="md-icon">all_inclusive</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                blog
              </span>
              <span class="md-header-nav__topic">
                4869 相逢是问候
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/plextem/blog/" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      plextem/blog
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." title="首页" class="md-tabs__link">
        首页
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../articles/fractional-programming/fp/" title="专题总结" class="md-tabs__link">
          专题总结
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../bz1053/" title="做题记录" class="md-tabs__link md-tabs__link--active">
          做题记录
        </a>
      
    </li>
  

  

      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="blog" class="md-nav__button md-logo">
      
        <i class="md-icon">all_inclusive</i>
      
    </a>
    blog
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/plextem/blog/" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      plextem/blog
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="首页" class="md-nav__link">
      首页
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      专题总结
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        专题总结
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/fractional-programming/fp/" title="分数规划" class="md-nav__link">
      分数规划
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      网络流24题总结
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        网络流24题总结
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/1/" title="1.飞行员配对方案问题" class="md-nav__link">
      1.飞行员配对方案问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/2/" title="2.太空飞行计划问题" class="md-nav__link">
      2.太空飞行计划问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/3/" title="3.最小路径覆盖问题" class="md-nav__link">
      3.最小路径覆盖问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/4/" title="4.魔术球问题" class="md-nav__link">
      4.魔术球问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/5/" title="5.圆桌问题" class="md-nav__link">
      5.圆桌问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/6/" title="6.最长不下降子序列问题" class="md-nav__link">
      6.最长不下降子序列问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/7/" title="7.试题库问题" class="md-nav__link">
      7.试题库问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/8/" title="8.机器人路径规划问题" class="md-nav__link">
      8.机器人路径规划问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/9/" title="9.方格取数问题" class="md-nav__link">
      9.方格取数问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/10/" title="10.餐巾计划问题" class="md-nav__link">
      10.餐巾计划问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/11/" title="11.航空路线问题" class="md-nav__link">
      11.航空路线问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/12/" title="12.软件补丁问题" class="md-nav__link">
      12.软件补丁问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/13/" title="13.星际转移问题" class="md-nav__link">
      13.星际转移问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/14/" title="14.孤岛营救问题" class="md-nav__link">
      14.孤岛营救问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/15/" title="15.汽车加油问题" class="md-nav__link">
      15.汽车加油问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/16/" title="16.数字梯形问题" class="md-nav__link">
      16.数字梯形问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/17/" title="17.运输问题" class="md-nav__link">
      17.运输问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/18/" title="18.分配问题" class="md-nav__link">
      18.分配问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/19/" title="19.负载平衡问题" class="md-nav__link">
      19.负载平衡问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/20/" title="20.深海机器人问题" class="md-nav__link">
      20.深海机器人问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/21/" title="21.最长k可重区间集问题" class="md-nav__link">
      21.最长k可重区间集问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/22/" title="22.最长k可重线段集问题" class="md-nav__link">
      22.最长k可重线段集问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/23/" title="23.火星探险问题" class="md-nav__link">
      23.火星探险问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/NetWork24/24/" title="24.骑士共存问题" class="md-nav__link">
      24.骑士共存问题
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      做题记录
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        做题记录
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1" checked>
    
    <label class="md-nav__link" for="nav-3-1">
      BZOJ
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        BZOJ
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../bz1053/" title="1053 反素数" class="md-nav__link">
      1053 反素数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bz1060/" title="1060 时态同步" class="md-nav__link">
      1060 时态同步
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bz1087/" title="1087 互不侵犯" class="md-nav__link">
      1087 互不侵犯
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bz1565/" title="1565 植物大战僵尸" class="md-nav__link">
      1565 植物大战僵尸
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bz3668/" title="3668 起床困难综合症" class="md-nav__link">
      3668 起床困难综合症
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bz4720/" title="4720 换教室" class="md-nav__link">
      4720 换教室
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bz4800/" title="4800 世界冰球锦标赛" class="md-nav__link">
      4800 世界冰球锦标赛
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        4869 相逢是问候
      </label>
    
    <a href="./" title="4869 相逢是问候" class="md-nav__link md-nav__link--active">
      4869 相逢是问候
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="题面" class="md-nav__link">
    题面
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="题解" class="md-nav__link">
    题解
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="程序" class="md-nav__link">
    程序
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      luogu
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        luogu
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../luogu/luogu1084/" title="1084 疫情控制" class="md-nav__link">
      1084 疫情控制
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../luogu/luogu1967/" title="1967 货车运输" class="md-nav__link">
      1967 货车运输
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../luogu/luogu2680/" title="2680 运输计划" class="md-nav__link">
      2680 运输计划
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../luogu/luogu2831/" title="2831 愤怒的小鸟" class="md-nav__link">
      2831 愤怒的小鸟
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../luogu/luogu3953/" title="3953 逛公园" class="md-nav__link">
      3953 逛公园
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      atcoder
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        atcoder
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../atcoder/agc028_b/" title="agc028 Removing Blocks" class="md-nav__link">
      agc028 Removing Blocks
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../links/" title="友链" class="md-nav__link">
      友链
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="题面" class="md-nav__link">
    题面
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="题解" class="md-nav__link">
    题解
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="程序" class="md-nav__link">
    程序
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/plextem/blog/blob/master/docs/prac/bzoj/bz4869.md" title="编辑此页" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="bzoj4869">BZOJ4869 相逢是问候<a class="headerlink" href="#bzoj4869" title="Permanent link">&para;</a></h1>
<h2 id="_1">题面<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>维护长为 <span><span class="MathJax_Preview">N(N\leq 50000)</span><script type="math/tex">N(N\leq 50000)</script></span> 的数组，支持两个操作：</p>
<ol>
<li><span><span class="MathJax_Preview">0\ \ l\ \ r</span><script type="math/tex">0\ \ l\ \ r</script></span> 将<span><span class="MathJax_Preview">l</span><script type="math/tex">l</script></span>至<span><span class="MathJax_Preview">r</span><script type="math/tex">r</script></span>中的数<span><span class="MathJax_Preview">a_i</span><script type="math/tex">a_i</script></span>变为<span><span class="MathJax_Preview">c^{a_i}</span><script type="math/tex">c^{a_i}</script></span>，其中<span><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span>为一个一开始给定的常数。</li>
<li><span><span class="MathJax_Preview">1\ \ l\ \ r</span><script type="math/tex">1\ \ l\ \ r</script></span>　查询<span><span class="MathJax_Preview">l</span><script type="math/tex">l</script></span>到<span><span class="MathJax_Preview">r</span><script type="math/tex">r</script></span>中所有数的和。</li>
</ol>
<p>操作数为<span><span class="MathJax_Preview">M(M\leq 50000)</span><script type="math/tex">M(M\leq 50000)</script></span>。</p>
<p>输出全部 <span><span class="MathJax_Preview">\mod p</span><script type="math/tex">\mod p</script></span>,<span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>为一个一开始就给定的常数(<span><span class="MathJax_Preview">p\leq 10^8</span><script type="math/tex">p\leq 10^8</script></span>)。</p>
<h2 id="_2">题解<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>又是一道和扩展欧拉定理有关的线段树题。</p>
<p>根据扩展欧拉定理:</p>
<div>
<div class="MathJax_Preview">a^b\equiv\begin{cases} a^{b\bmod\varphi(p)},\,&amp;\gcd(a,\,p)=1\\ a^b,&amp;\gcd(a,\,p)\ne1,\,b&lt;\varphi(p)\\ a^{b\bmod\varphi(p)+\varphi(p)},&amp;\gcd(a,\,p)\ne1,\,b\ge\varphi(p) \end{cases} \pmod p </div>
<script type="math/tex; mode=display">a^b\equiv\begin{cases} a^{b\bmod\varphi(p)},\,&\gcd(a,\,p)=1\\ a^b,&\gcd(a,\,p)\ne1,\,b<\varphi(p)\\ a^{b\bmod\varphi(p)+\varphi(p)},&\gcd(a,\,p)\ne1,\,b\ge\varphi(p) \end{cases} \pmod p </script>
</div>
<p>那么如果设<span><span class="MathJax_Preview">d=c^x</span><script type="math/tex">d=c^x</script></span></p>
<p>那么<span><span class="MathJax_Preview">c^{c^x}=c^d</span><script type="math/tex">c^{c^x}=c^d</script></span>,当<span><span class="MathJax_Preview">d&gt;\varphi(p)</span><script type="math/tex">d>\varphi(p)</script></span>时：</p>
<div>
<div class="MathJax_Preview">\Large c^d=c^{d\%\varphi(p)+\varphi(p)}=c^{c^x\%\varphi(p)+\varphi(p)}</div>
<script type="math/tex; mode=display">\Large c^d=c^{d\%\varphi(p)+\varphi(p)}=c^{c^x\%\varphi(p)+\varphi(p)}</script>
</div>
<div>
<div class="MathJax_Preview">\huge =c^{c^{x\%\varphi(\varphi(p))+\varphi(\varphi(p))}+\varphi(p)}</div>
<script type="math/tex; mode=display">\huge =c^{c^{x\%\varphi(\varphi(p))+\varphi(\varphi(p))}+\varphi(p)}</script>
</div>
<p>经过自己手动将剩下的<span><span class="MathJax_Preview">\varphi(p)</span><script type="math/tex">\varphi(p)</script></span>一个个提出来之后发现会有很多<span><span class="MathJax_Preview">\varphi</span><script type="math/tex">\varphi</script></span>套在一起。</p>
<p>然后注意到<span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>变到<span><span class="MathJax_Preview">\varphi(p)</span><script type="math/tex">\varphi(p)</script></span>,<span><span class="MathJax_Preview">\varphi(\varphi(p))</span><script type="math/tex">\varphi(\varphi(p))</script></span>，只要<span><span class="MathJax_Preview">\log p</span><script type="math/tex">\log p</script></span>次就会变成<span><span class="MathJax_Preview">1</span><script type="math/tex">1</script></span>。</p>
<p>当<span><span class="MathJax_Preview">\varphi^k(p)=1</span><script type="math/tex">\varphi^k(p)=1</script></span>时<span><span class="MathJax_Preview">c^{x\%\varphi}=0</span><script type="math/tex">c^{x\%\varphi}=0</script></span>，于是此时就不需要继续修改这个点了。</p>
<p>于是建一颗线段树，线段树每个节点维护两个值，一个是这个区间中数之和<span><span class="MathJax_Preview">sum</span><script type="math/tex">sum</script></span>，另一个是区间中修改次数最少的数的个数<span><span class="MathJax_Preview">mn</span><script type="math/tex">mn</script></span>。</p>
<p>当节点的<span><span class="MathJax_Preview">mn</span><script type="math/tex">mn</script></span>的值<span><span class="MathJax_Preview">\geq p</span><script type="math/tex">\geq p</script></span>变成<span><span class="MathJax_Preview">1</span><script type="math/tex">1</script></span>所需步数时不用修改当前节点，否则递归下去暴力修改。</p>
<p>但是这样的复杂度为<span><span class="MathJax_Preview">n\log^2n\cdot\log p</span><script type="math/tex">n\log^2n\cdot\log p</script></span>,无法通过此题，但是使用<a href="https://blog.sengxian.com/solutions/bzoj-4869">Sengxian的方法</a>可以将<span><span class="MathJax_Preview">c^x\% \varphi^k(p)</span><script type="math/tex">c^x\% \varphi^k(p)</script></span>优化到<span><span class="MathJax_Preview">O(1)</span><script type="math/tex">O(1)</script></span>.</p>
<div class="admonition quote">
<p class="admonition-title">Sengxian的方法</p>
<p>具体做法是预处理 <span><span class="MathJax_Preview">\mathrm{pow_1}(n)</span><script type="math/tex">\mathrm{pow_1}(n)</script></span> 表示 <span><span class="MathJax_Preview">c^n\bmod p</span><script type="math/tex">c^n\bmod p</script></span> 的值，处理到 <span><span class="MathJax_Preview">65536</span><script type="math/tex">65536</script></span>；再预处理 <span><span class="MathJax_Preview">\mathrm{pow_2}(n)</span><script type="math/tex">\mathrm{pow_2}(n)</script></span> 表示 <span><span class="MathJax_Preview">c^n</span><script type="math/tex">c^n</script></span> 平方 <span><span class="MathJax_Preview">16</span><script type="math/tex">16</script></span> 次 <span><span class="MathJax_Preview">\mathrm{mod}\;p</span><script type="math/tex">\mathrm{mod}\;p</script></span> 的值，同样处理到 <span><span class="MathJax_Preview">65536</span><script type="math/tex">65536</script></span>，则 <span><span class="MathJax_Preview">c^x\bmod p</span><script type="math/tex">c^x\bmod p</script></span> 可以通过分两段查表的方式快速算出： </p>
<p><code>pow1[b &amp; 65535] * pow2[b &gt;&gt; 16] % mod</code></p>
<p>由于只有 <span><span class="MathJax_Preview">O(\log n)</span><script type="math/tex">O(\log n)</script></span> 个模数，对每个模数都预处理，那么复杂度为：<span><span class="MathJax_Preview">O(65536 \cdot 16\log n)</span><script type="math/tex">O(65536 \cdot 16\log n)</script></span>。</p>
</div>
<h2 id="_3">程序<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp"></span>
<span class="cp">#define MAX_N 100007</span>
<span class="cp">#define ls (x &lt;&lt; 1)</span>
<span class="cp">#define rs (x &lt;&lt; 1 | 1)</span>
<span class="cp">#define __x % __y (__x - __x / __y * __y)</span>
<span class="cp">#define reg register</span>
<span class="k">typedef</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">ll</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">tot</span><span class="p">;</span>
<span class="n">ll</span> <span class="n">MOD</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">sum</span><span class="p">[</span><span class="n">MAX_N</span> <span class="o">*</span> <span class="mi">4</span><span class="p">],</span> <span class="n">mn</span><span class="p">[</span><span class="n">MAX_N</span> <span class="o">*</span> <span class="mi">4</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">MAX_N</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">pow1</span><span class="p">[</span><span class="mi">50</span><span class="p">][</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">],</span> <span class="n">pow2</span><span class="p">[</span><span class="mi">50</span><span class="p">][</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">],</span> <span class="n">cnt</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">phi</span><span class="p">,</span> <span class="n">nums</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">read</span> <span class="p">(</span><span class="n">reg</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">reg</span> <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="sc">&#39;0&#39;</span> <span class="o">||</span> <span class="sc">&#39;9&#39;</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">)</span> <span class="n">c</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="sc">&#39;0&#39;</span> <span class="o">&lt;=</span> <span class="n">c</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">&#39;9&#39;</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">c</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">ll</span> <span class="n">quick_pow</span> <span class="p">(</span><span class="n">reg</span> <span class="n">ll</span> <span class="n">x</span><span class="p">,</span> <span class="n">reg</span> <span class="n">ll</span> <span class="n">p</span><span class="p">,</span> <span class="n">reg</span> <span class="n">ll</span> <span class="n">mod</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">C</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="n">mod</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">reg</span> <span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ans</span> <span class="o">&gt;=</span> <span class="n">mod</span><span class="p">)</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span> <span class="o">%</span> <span class="n">mod</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">p</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">mod</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">%</span> <span class="n">mod</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ans</span> <span class="o">+</span> <span class="n">tmp</span> <span class="o">*</span> <span class="n">mod</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">ll</span> <span class="n">quick_quick_pow</span> <span class="p">(</span><span class="n">reg</span> <span class="n">ll</span> <span class="n">x</span><span class="p">,</span> <span class="n">reg</span> <span class="n">ll</span> <span class="n">mod</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">reg</span> <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">nums</span><span class="p">[</span><span class="n">mod</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">cnt</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="k">return</span> <span class="n">pow1</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">x</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">pow1</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mi">65535</span><span class="p">]</span> <span class="o">*</span> <span class="n">pow2</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">]</span> <span class="o">%</span> <span class="n">mod</span> <span class="o">+</span> <span class="n">mod</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">ll</span> <span class="n">calc</span> <span class="p">(</span><span class="n">reg</span> <span class="n">ll</span> <span class="n">x</span><span class="p">,</span> <span class="n">reg</span> <span class="kt">int</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">reg</span> <span class="n">ll</span> <span class="n">mod</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mod</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">C</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="n">C</span> <span class="o">%</span> <span class="n">mod</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">mod</span> <span class="o">?</span> <span class="nl">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="n">mod</span> <span class="o">+</span> <span class="n">mod</span><span class="p">;</span>
    <span class="k">return</span> <span class="nf">quick_quick_pow</span><span class="p">(</span><span class="n">calc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">phi</span><span class="p">[</span><span class="n">mod</span><span class="p">]),</span> <span class="n">mod</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">ll</span> <span class="n">calc</span> <span class="p">(</span><span class="n">reg</span> <span class="n">ll</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">reg</span> <span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">reg</span> <span class="n">ll</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> 
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span> <span class="o">/</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">x</span> <span class="o">/=</span> <span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span> <span class="o">/</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="n">init</span> <span class="p">()</span> <span class="p">{</span>
    <span class="n">reg</span> <span class="n">ll</span> <span class="n">p</span> <span class="o">=</span> <span class="n">MOD</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">x</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">nums</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="o">++</span><span class="n">tot</span><span class="p">;</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">calc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
        <span class="n">phi</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">nums</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">++</span><span class="n">tot</span><span class="p">;</span>
    <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">MOD</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">reg</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="n">tot</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pow1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">reg</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endd</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">endd</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
            <span class="n">pow1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">pow1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span> <span class="o">%</span> <span class="n">p</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">reg</span> <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">endd</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">endd</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">pow2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">pow1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">reg</span> <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">k</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
                <span class="n">pow2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">pow2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">pow2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">%</span> <span class="n">p</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">C</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">x</span> <span class="o">*=</span> <span class="n">C</span><span class="p">,</span> <span class="o">++</span><span class="n">tmp</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="n">ll</span> <span class="n">min</span> <span class="p">(</span><span class="n">ll</span> <span class="n">a</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span> <span class="o">?</span> <span class="nl">a</span> <span class="p">:</span> <span class="n">b</span><span class="p">;}</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="n">update</span> <span class="p">(</span><span class="n">reg</span> <span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">sum</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum</span><span class="p">[</span><span class="n">ls</span><span class="p">]</span> <span class="o">+</span> <span class="n">sum</span><span class="p">[</span><span class="n">rs</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sum</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">MOD</span><span class="p">)</span> <span class="n">sum</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
    <span class="n">mn</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">mn</span><span class="p">[</span><span class="n">ls</span><span class="p">],</span> <span class="n">mn</span><span class="p">[</span><span class="n">rs</span><span class="p">]);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">build</span> <span class="p">(</span><span class="n">reg</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">reg</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">reg</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">read</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">]);</span>
        <span class="n">sum</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">];</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">reg</span> <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">build</span><span class="p">(</span><span class="n">ls</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">mid</span><span class="p">);</span>
    <span class="n">build</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
    <span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">modify</span> <span class="p">(</span><span class="n">reg</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">reg</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">reg</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="n">reg</span> <span class="kt">int</span> <span class="n">ql</span><span class="p">,</span> <span class="n">reg</span> <span class="kt">int</span> <span class="n">qr</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="n">qr</span> <span class="o">||</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">ql</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mn</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">tot</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">sum</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="o">++</span><span class="n">mn</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">MOD</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">reg</span> <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ql</span> <span class="o">&lt;=</span> <span class="n">mid</span><span class="p">)</span> <span class="n">modify</span><span class="p">(</span><span class="n">ls</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mid</span> <span class="o">&lt;</span> <span class="n">qr</span><span class="p">)</span> <span class="n">modify</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">);</span>
    <span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">ll</span> <span class="n">query</span> <span class="p">(</span><span class="n">reg</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">reg</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">reg</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="n">reg</span> <span class="kt">int</span> <span class="n">ql</span><span class="p">,</span> <span class="n">reg</span> <span class="kt">int</span> <span class="n">qr</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="n">qr</span> <span class="o">||</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">ql</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ql</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">qr</span><span class="p">)</span> <span class="k">return</span> <span class="n">sum</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
    <span class="n">reg</span> <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">reg</span> <span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ql</span> <span class="o">&lt;=</span> <span class="n">mid</span><span class="p">)</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="n">ls</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mid</span> <span class="o">&lt;</span> <span class="n">qr</span><span class="p">)</span> <span class="n">ans</span> <span class="o">=</span> <span class="p">(</span><span class="n">ans</span> <span class="o">+</span> <span class="n">query</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">ans</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span> <span class="p">()</span> <span class="p">{</span>
    <span class="n">read</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">read</span><span class="p">(</span><span class="n">M</span><span class="p">);</span>
    <span class="n">read</span><span class="p">(</span><span class="n">MOD</span><span class="p">),</span> <span class="n">read</span><span class="p">(</span><span class="n">C</span><span class="p">);</span>
    <span class="n">init</span><span class="p">();</span>
    <span class="n">build</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
    <span class="n">reg</span> <span class="kt">int</span> <span class="n">op</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">M</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">read</span><span class="p">(</span><span class="n">op</span><span class="p">);</span>
        <span class="n">read</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
        <span class="n">read</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//modify</span>
            <span class="n">modify</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">//query</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%lld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../bz4800/" title="4800 世界冰球锦标赛" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                4800 世界冰球锦标赛
              </span>
            </div>
          </a>
        
        
          <a href="../../luogu/luogu1084/" title="1084 疫情控制" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                1084 疫情控制
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 - 2018 plextem
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.583bbe55.js"></script>
      
        
        
          
          <script src="../../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.3",url:{base:"../../.."}})</script>
      
        <script src="../../../_static/js/extra.js?v=2"></script>
      
        <script src="https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
    
      
    
  </body>
</html>